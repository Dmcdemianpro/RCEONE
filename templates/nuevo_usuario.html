{% extends "base.html" %}

{% block title %}Crear Nuevo Usuario{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Crear Nuevo Usuario</h1>
    
    <!-- Mensajes flash (si los usas) -->
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-info" role="alert">
          {{ messages[0] }}
        </div>
      {% endif %}
    {% endwith %}
    
    <form action="{{ url_for('nuevo_usuario') }}" method="post">
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="username" class="form-label">Username</label>
          <input
            type="text"
            class="form-control"
            id="username"
            name="username"
            required
          >
        </div>
        <div class="col-md-6">
          <label for="password" class="form-label">Password</label>
          <input
            type="password"
            class="form-control"
            id="password"
            name="password"
            required
          >
        </div>
      </div>
      
      <div>
        <label for="role">Rol</label>
        <select name="role" id="role">
            <option value="usuario">Usuario</option>
            <!-- IMPORTANT: Sin espacios ni tildes, tal cual 'medico' -->
            <option value="medico">Médico</option> 
            <option value="admin">Administrador</option>
        </select>
    </div>

    <div>
        <label for="username">Nombre de Usuario</label>
        <input type="text" name="username" id="username" required>
    </div>

    <div>
        <label for="password">Contraseña</label>
        <input type="password" name="password" id="password" required>
    </div>

    <!-- Campos de Profesional (solo se usarán si role=medico) -->
    <div id="datosMedico" style="margin-top: 1rem;">
        <label>RUN Profesional</label>
        <input type="text" name="run_profesional" id="run_profesional">

        <label>Nombre Profesional</label>
        <input type="text" name="nombre_profesional" id="nombre_profesional">

        <!-- Campo único para ambos apellidos -->
        <label>Apellidos Profesional (ej. "García Pérez")</label>
        <input type="text" name="apellido_profesional" id="apellido_profesional">

        <label>Tipo Profesional</label>
        <input type="text" name="tipo_profesional" id="tipo_profesional">
    </div>

    <button type="submit">Crear Usuario</button>
</form>

<script>
// Opcional: mostrar/ocultar los campos de médico si role=medico
document.getElementById('role').addEventListener('change', function() {
    const datosMedico = document.getElementById('datosMedico');
    if (this.value === 'medico') {
        datosMedico.style.display = 'block';
    } else {
        datosMedico.style.display = 'none';
    }
});
</script>
      
      <div class="mt-4">
        <button type="submit" class="btn btn-primary">Crear Usuario</button>
        <a href="{{ url_for('listar_usuarios') }}" class="btn btn-secondary">
          Cancelar
        </a>
      </div>
    </form>
</div>

<!-- Script para mostrar/ocultar los campos de datos profesionales -->
<script>
    function toggleProfessionalFields() {
        var role = document.getElementById('role').value;
        var professionalFields = document.getElementById('professionalFields');
        if (role === 'medico') {
            professionalFields.style.display = 'block';
        } else {
            professionalFields.style.display = 'none';
        }
    }
</script>
{% endblock %}
